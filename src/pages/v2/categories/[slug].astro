---
import Layout from '../../../layouts/BaseLayout.astro';
import BlogList from '../../../components/v2/BlogList.astro';
import { TOPIC_CATEGORIES } from '../../../data/categories';
import { getV2Posts } from '../../../utils/getV2Posts';

export function getStaticPaths() {
  return TOPIC_CATEGORIES.map((category) => ({
    params: { slug: category.slug },
  }));
}

const slug = Astro.params.slug ?? '';
const category = TOPIC_CATEGORIES.find((cat) => cat.slug === slug);

if (!category) {
  throw new Error('Category not found');
}

const posts = (await getV2Posts()).filter(
  (post) => Array.isArray(post.data.topics) && (post.data.topics.includes(category.key) || post.data.topics.includes(slug))
);

const emojiMap: Record<string, string> = {
  briefcase: 'üíº',
  school: 'üéí',
  heart: '‚ù§Ô∏è',
  brain: 'üß†',
  alert: '‚ö†Ô∏è',
};

const icon = emojiMap[category.icon] ?? '‚≠ê';
const title = category.label;
const description = category.description ?? 'Explore the latest articles in this category.';
---

<Layout>
  <main class="bg-white py-16 text-neutral-900">
    <div class="mx-auto max-w-screen-xl space-y-10 px-4 sm:px-6 lg:px-8">
      <!-- Category hero -->
      <header class="flex flex-col gap-4 rounded-3xl border border-neutral-200 bg-gradient-to-r from-white to-neutral-50 p-6 shadow-sm sm:flex-row sm:items-center sm:justify-between">
        <div class="flex items-center gap-4">
          <span
            class="inline-flex h-12 w-12 items-center justify-center rounded-full text-xl"
            style={`background-color:${category.color}1a; color:${category.color};`}
            aria-hidden="true"
          >
            {icon}
          </span>
          <div class="space-y-1">
            <p class="text-xs uppercase tracking-[0.35em] text-neutral-500">Category</p>
            <h1 class="text-2xl font-extrabold text-neutral-900 sm:text-3xl">{title}</h1>
            {description && <p class="text-sm text-neutral-700 sm:text-base">{description}</p>}
          </div>
        </div>
        <a
          href="/v2/blog"
          class="inline-flex items-center justify-center rounded-full border border-neutral-200 px-4 py-2 text-sm font-semibold text-neutral-900 transition hover:border-neutral-300 hover:text-neutral-900 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-neutral-800"
        >
          Back to Blog
        </a>
      </header>

      <!-- Posts scoped to category -->
      <BlogList
        posts={posts}
        currentPage={1}
        totalPages={1}
        basePath={`/v2/categories/${category.slug}`}
        title="Articles in this topic"
        description={description}
        eyebrow={category.label}
      />
    </div>
  </main>
</Layout>
