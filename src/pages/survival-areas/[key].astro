---
import { getCollection } from 'astro:content';
import HubLayout from '../../layouts/HubLayout.astro';
import { SURVIVAL_HUBS } from '../../data/hubs';
import { getPillarFromPost } from '../../utils/postLinking';
import { sortPosts } from '../../utils/postSections';

export async function getStaticPaths() {
  const posts = await getCollection('posts');
  const published = posts.filter((post) => !post.data.draft);

  return SURVIVAL_HUBS.map((hub) => {
    const hubPosts = sortPosts(published.filter((post) => getPillarFromPost(post) === hub.key));
    return {
      params: { key: hub.key },
      props: { hub, hubPosts },
      route: `${hub.slug}/`,
    };
  });
}

const { hub, hubPosts } = Astro.props;
---

<HubLayout hub={hub} posts={hubPosts} />
