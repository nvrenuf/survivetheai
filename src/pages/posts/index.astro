---
import Layout from '../../layouts/BaseLayout.astro';
import BlogList from '../../components/BlogList.astro';
import { getCollection } from 'astro:content';
import { sortPosts } from '../../utils/postSections';

const pageSize = 6;
const posts = sortPosts(await getCollection('posts')).filter((post) => !post.data.draft);
const totalPages = Math.max(1, Math.ceil(posts.length / pageSize));
const pagePosts = posts.slice(0, pageSize);
const pageTitle = 'All Posts';
---

<Layout title={`${pageTitle} Â· Survive the AI`} description="Browse every SurviveTheAI post in reverse chronological order.">
  <main class="bg-white py-14 text-neutral-900 sm:py-16">
    <div class="mx-auto max-w-screen-xl space-y-6 px-4 sm:px-6 lg:px-8">
      <div class="space-y-2">
        <p class="text-xs font-semibold uppercase tracking-[0.3em] text-neutral-500">Archive</p>
        <h1 class="text-3xl font-extrabold text-neutral-900 sm:text-4xl">{pageTitle}</h1>
        <p class="text-neutral-600">Newest first, six posts per page.</p>
      </div>

      <BlogList posts={pagePosts} currentPage={1} totalPages={totalPages} basePath="/posts" />
    </div>
  </main>
</Layout>
