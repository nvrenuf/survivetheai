---
import type { PostEntry } from '../content/config';
import PostCard from './PostCard.astro';

const { posts, currentPage, totalPages, basePath } = Astro.props as {
  posts: PostEntry[];
  currentPage: number;
  totalPages: number;
  basePath: string;
};

const normalizedBasePath = basePath.endsWith('/') ? basePath.slice(0, -1) : basePath;
const buildPageHref = (page: number) => (page === 1 ? `${normalizedBasePath}/` : `${normalizedBasePath}/page/${page}/`);
---

<div class="space-y-8" data-testid="blog-list" data-total-pages={totalPages} data-current-page={currentPage}>
  <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3">
    {posts.map((post) => (
      <PostCard post={post} />
    ))}
  </div>

  {totalPages > 1 && (
    <nav class="flex flex-wrap items-center justify-center gap-2 text-sm font-semibold" aria-label="Pagination" data-testid="pagination">
      <a
        class={`rounded-full border px-3 py-1 transition ${
          currentPage > 1
            ? 'border-neutral-300 text-neutral-800 hover:border-neutral-500 hover:text-neutral-950'
            : 'cursor-not-allowed border-neutral-200 text-neutral-400'
        }`}
        aria-disabled={currentPage === 1}
        href={currentPage > 1 ? buildPageHref(currentPage - 1) : undefined}
      >
        Previous
      </a>
      {Array.from({ length: totalPages }, (_, index) => {
        const page = index + 1;
        const isActive = page === currentPage;
        return (
          <a
            href={buildPageHref(page)}
            class={`min-w-[44px] rounded-full px-3 py-1 text-center transition ${
              isActive
                ? 'bg-neutral-900 text-white'
                : 'border border-neutral-300 text-neutral-800 hover:border-neutral-500 hover:text-neutral-950'
            }`}
          >
            {page}
          </a>
        );
      })}
      <a
        class={`rounded-full border px-3 py-1 transition ${
          currentPage < totalPages
            ? 'border-neutral-300 text-neutral-800 hover:border-neutral-500 hover:text-neutral-950'
            : 'cursor-not-allowed border-neutral-200 text-neutral-400'
        }`}
        aria-disabled={currentPage === totalPages}
        href={currentPage < totalPages ? buildPageHref(currentPage + 1) : undefined}
      >
        Next
      </a>
    </nav>
  )}
</div>
