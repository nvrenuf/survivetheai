---
import type { PostEntry } from '../content/config';
import { TOPIC_CATEGORIES } from '../data/categories';
import { formatDate } from '../utils/format';

const { post } = Astro.props as { post: PostEntry };

const categoryByKey = new Map(TOPIC_CATEGORIES.map((c) => [c.key, c]));
const primaryCategory = post.data.topics?.[0] ? categoryByKey.get(post.data.topics[0]) : undefined;
const categoryLabel = primaryCategory?.label ?? post.data.category ?? 'Key Topic';
const dateLabel = formatDate(post.data.date);
const FALLBACK_HERO = '/images/placeholder-hero.svg';
const imageSrc = (post.data.heroImageThumb ?? post.data.heroImage)?.trim() || FALLBACK_HERO;
const imageAlt = post.data.heroImageAlt ?? post.data.title;
---

<a
  href={`/posts/${post.slug}/`}
  class="group flex h-full flex-col overflow-hidden rounded-2xl border border-neutral-200 bg-white shadow-sm transition hover:-translate-y-0.5 hover:border-neutral-300 hover:shadow-md focus:outline-none focus-visible:ring-2 focus-visible:ring-neutral-400"
>
  <div class="relative aspect-[16/9] overflow-hidden bg-neutral-100">
    <img
      src={imageSrc}
      alt={imageAlt}
      loading="lazy"
      decoding="async"
      width="640"
      height="360"
      class="h-full w-full object-cover transition duration-300 group-hover:scale-[1.02]"
    />
  </div>
  <div class="flex flex-1 flex-col gap-4 p-5">
    <div class="flex items-center gap-2 text-[10px] font-semibold uppercase tracking-[0.32em] text-neutral-500">
      <span>{categoryLabel}</span>
      <span aria-hidden class="h-1 w-1 rounded-full bg-neutral-300" />
      <span>{dateLabel}</span>
    </div>
    <h3 class="text-xl font-bold leading-tight text-neutral-900 transition group-hover:text-neutral-700 line-clamp-2">
      {post.data.title}
    </h3>
    <p class="text-sm leading-relaxed text-neutral-600 line-clamp-3">{post.data.description}</p>
    <div class="mt-auto flex items-center text-[10px] font-semibold uppercase tracking-[0.32em] text-neutral-500">
      <span>Impact Score {post.data.impact_score}</span>
    </div>
  </div>
</a>
