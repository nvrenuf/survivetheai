---
import type { PostEntry } from '../content/config';
import { formatDate } from '../utils/format';

const { related, heading = 'Related reading' } = Astro.props as {
  related: PostEntry[];
  heading?: string;
};
---
<section class="space-y-4">
  <h2 class="text-xs font-semibold uppercase tracking-[0.3em] text-neutral-600">{heading}</h2>
  <ul class="space-y-4">
    {related.map((entry) => {
      const heroImage = entry.data.heroImage;
      const dateLabel = formatDate(entry.data.date);
      const hasHero = typeof heroImage === 'string' && heroImage.trim().length > 0;

      return (
        <li>
          <a href={`/posts/${entry.slug}/`} class="group flex items-center gap-4 rounded-2xl border border-neutral-200 p-2 transition hover:border-neutral-300 hover:bg-neutral-50">
            <div class="relative h-14 w-14 overflow-hidden rounded-xl border border-neutral-200 bg-neutral-50">
              {hasHero && (
                <img
                  src={heroImage}
                  alt={entry.data.title}
                  loading="lazy"
                  decoding="async"
                  width="56"
                  height="56"
                  class="h-full w-full object-cover"
                  onerror="this.style.display='none'; const placeholder = this.nextElementSibling; if (placeholder) placeholder.classList.remove('hidden');"
                />
              )}
              <div class={`absolute inset-0 flex items-center justify-center text-[10px] font-medium text-neutral-400 ${hasHero ? 'hidden' : ''}`}>
                No image
              </div>
            </div>
            <div class="space-y-1">
              <p
                class="text-sm font-semibold text-neutral-900 transition group-hover:text-neutral-700"
                style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;"
              >
                {entry.data.title}
              </p>
              <p class="text-xs text-neutral-600">{dateLabel}</p>
            </div>
          </a>
        </li>
      );
    })}
  </ul>
</section>
